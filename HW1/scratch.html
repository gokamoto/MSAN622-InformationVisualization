<!DOCTYPE html>
<html lang="en">

	<head>
		<!-- import d3 -->
		<script type="text/javascript" src="http://d3js.org/d3.v3.min.js"></script>
	</head>

	<body>
		<script type="text/javascript">
			// The data
			//var dataset = [ 5, 10, 13, 19, 21, 25, 22, 18, 15, 13,
			//                11, 12, 15, 20, 18, 17, 16, 18, 23, 25 ];

			// Get uri search portion
			var uri = document.location.search;
			// Decode and convert to lower case
			var uriDecoded = decodeURI(uri).toLowerCase();
			// Remove any non-alphanumeric characters
			var uriRegex = uriDecoded.replace(/[^a-z0-9]/, '');
			
			// var uriRegex = "helloworldhelloworldhelloworldhelloworldhelloworldhelloworld";

			// Create letter counter using javascript object
			var counter = {};

			// For every letter in uri string
			for (var i = 0; i < uriRegex.length; i++) {
				// If letter in object, add 1 to count
				if (uriRegex[i] in counter) {
			    	counter[uriRegex[i]] += 1;
			  	}
			  	// If letter not in object, set count to 1
				else {
			    	counter[uriRegex[i]] = 1;
			  	}
			}

			// Extract counts and put into array
			var dataset = [];
			for (var prop in counter) {
				dataset.push(counter[prop])
			}

			// Put letters into an array
			var letters = Object.keys(counter);

			//Width and height
			var w = 800;
			var h = 500;
			var barPadding = 5;
			var leftMargin = 50;
			var rightMargin = 0;
			var bottomMargin = 50;
			var topMargin = 10;
			var hSub = h - topMargin - bottomMargin;
			var wSub = w - leftMargin - rightMargin;

			var maxVal = d3.max(dataset);

			//Create SVG element
			var svg = d3.select("body")
			            .append("svg")
			            .attr("width", w)
			            .attr("height", h);

			// generate rects and add them to svg
			/*This code selects all rects inside of svg. Of course, there aren’t any yet, so an empty selection is returned. (With D3, you always have to first select whatever it is you’re about to act on, even if that selection is momentarily empty.)*/
			svg.selectAll("rect")
			   .data(dataset)
			   .enter()
			   .append("rect")
			   // x = index + bar width of (svg width) / (number of bars)
			   .attr("x", function(d, i) {
    				return i * (wSub / dataset.length) + leftMargin;  
				})
			   // for svg (0,0) is upper left corner
			   .attr("y", function(d) {
    				return h - hSub*(d/maxVal) - bottomMargin;  //Height minus data value * 4
				})
			   // bar width of (svg width) / (number of bars)
			   .attr("width", wSub / dataset.length - barPadding)
			   // height is d = data value times 4 for sizing
			   .attr("height", function(d) {
    				return hSub*(d/maxVal);  // <-- Times four!
				})
			   .attr("fill", "teal");

			/*
			// Adding bar number labels 
			svg.selectAll("text")
			   .data(dataset)
			   .enter()
			   .append("text")
			   .text(function(d) {
			   		return d;
			   })
			   .attr('text-anchor', 'middle')
			   // x = index + bar width of (svg width) / (number of bars)
			   .attr("x", function(d, i) {
    				return i*(w/dataset.length) + 0.5*(w/dataset.length-barPadding);  
				})
			   .attr("y", function(d, i) {
			   		return h - h*(d/maxVal) + 15;
			    })
			   .attr("font-family", "sans-serif")
   			   .attr("font-size", "11px")
   			   .attr("fill", "white"); */

   			// Adding bar letter labels
   			svg.selectAll("text")
   			   .data(letters)
   			   .enter()
   			   .append("text")
   			   .text(function(d) {
   			   		return d;
   			   })
   			   .attr("x", function(d, i) {
   			   		return i*(wSub/dataset.length) + 0.5*(wSub/dataset.length-barPadding) + leftMargin;
   			   })
   			   .attr("y", h-(bottomMargin/2))
   			   .attr("font-family", "sans-serif")
   			   .attr("font-size", "12px");

   			var y = d3.scale.linear()
    			.range([hSub, 0]);

   			var yAxis = d3.svg.axis()
			    .scale(y)
			    .orient("left");

			svg.selectAll("g")
				.attr("class", "y axis")
      			.call(yAxis);


		</script>

	</body>

</html>
