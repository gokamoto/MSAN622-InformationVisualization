<!DOCTYPE html>
<html lang="en">

<head>
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1">

<title>MSAN 622 Information Visualization</title>

<link href="../css/bootstrap.min.css" rel="stylesheet">
<link href="../css/bootstrap-theme.min.css" rel="stylesheet">

<style type="text/css">

    body {
        padding-top: 50px;
        padding-bottom: 20px;
        padding-left: 50px;
        padding-right: 50px;
    }

    .myheader {
        font-size: 30px;
    }

    #barchartsTitle {
    font-family: sans-serif;
    font-size: 24px;
    text-align: center;
    }

    .neighborhoodLabel {
        font-family: sans-serif;
        font-size: 14px;
        font-weight: bold;
    }

    div#barcharts {
        max-width: 960px;
        margin: auto;
    }

    .axis line {
      stroke: #ddd;
    }

    .axis path {
        display: none;
    }

    .axis text {
        font-family: sans-serif;
        font-size: 10px;
    }


    #mapTitle {
    font-family: sans-serif;
    font-size: 24px;
    text-align: center;
    }

    #mapChart svg {
        display: block;
        margin: auto;
    }

    .land {
        fill: #CCCCCC;
    }

    .boundary {
        fill: none;
        stroke: white;
    }

    .dot {
        transition: fill 0.5s;
    }

    .d3-tip {
      line-height: 1;
      /*font-weight: bold;*/
      padding: 10px;
      /*background: rgba(0, 0, 0, 0.8);*/
      background: #fff;
      color: black;
      border-radius: 2px;
      font-family: sans-serif;
      font-size: 12px;
    }

    /* Creates a small triangle extender for the tooltip */
    .d3-tip:after {
      box-sizing: border-box;
      display: inline;
      font-size: 10px;
      width: 100%;
      line-height: 1;
      /*color: rgba(0, 0, 0, 0.8);*/
      color: white;
      content: "\25BC";
      position: absolute;
      text-align: center;
    }

    /* Style northward tooltips differently */
    .d3-tip.n:after {
      margin: -1px 0 0 0;
      top: 100%;
      left: 0;
    }

</style>


</head>

<body>

<!-- Fixed Navbar -->
<nav class="navbar navbar-inverse navbar-fixed-top">
    <div class="container">
        <div class="navbar-header">
            <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false" aria-controls="navbar">
                <span class="sr-only">Toggle Navigation</span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
            </button>
            <a class="navbar-brand" href="http://gokamoto.github.io/MSAN622-InformationVisualization">MSAN 622</a>
        </div>

        <div id="navbar" class="navbar-collapse collapse">
            <ul class="nav navbar-nav">
                <li><a href="http://gokamoto.github.io/MSAN622-InformationVisualization#homework">Homework</a></li>
                <li><a href="http://gokamoto.github.io/MSAN622-InformationVisualization#project">Project</a></li>
                <li><a href="http://gokamoto.github.io/MSAN622-InformationVisualization#participation">Participation</a></li>
            </ul>

            <ul class="nav navbar-nav navbar-right">
                <li><a href="http://gokamoto.github.io/MSAN622-InformationVisualization#about">About</a></li>
                <li><a href="http://gokamoto.github.io/MSAN622-InformationVisualization#contact">Contact</a></li>
            </ul>
        </div><!--/.nav-collapse -->
    </div>
</nav>

<div class="container">
    <div class="myheader">
        <h1>Project Prototype</h1>
    </div>
    <p> Griffin Okamoto </p>
    <a href="https://github.com/gokamoto/MSAN622-InformationVisualization/tree/gh-pages/Project/prototype.html">Source Code </a>
    
</div>

<div class="container">

<h3> Dataset Summary </h3>

This dataset contains all of the MUNI reports to <a href="http://www.sf311.org/">San Francisco 311</a> between January 1, 2015 and April 20, 2015. The original dataset, available on <a href="https://data.sfgov.org/City-Infrastructure/Case-Data-from-San-Francisco-311-SF311-/vw6y-z8j6">SF Open Data</a>, contains all 311 case data since July 1, 2008. Due to the sheer volume of data (340MB) and a particular interest in MUNI services, I am only using subset of the data pertaining to recent MUNI requests/reports. San Francisco 311 was established in March 2007 to provide an easy-to-remember telephone number to connect with customer service representatives for help with general government services and information. For a more detailed description of the data and the variables it contains, please see my <a href="dataset.html">Project Dataset</a> page.

<h3> Sketch Summary </h3>

The prototype visualizations below are for two of the 3 visualizations I intend to implement for this project. These visualizations are: a map of the MUNI cases, small multiples of barcharts showing the request types by neighborhood, and a time series line plot showing the number of open cases by neighborhood. These visualizations will include many types of interactivity, including hover details, filtering, and zooming. For the final project page, I plan to have a single visualization displayed at a time, with 3 thumbnails on the side to switch between visualizations. The only tools I am using in this project are R for data preprocessing and D3 for the visualizations. The full sketch can be found at my <a href="sketch.html">Project Sketch</a> page. 

<h3> Visualization Prototype </h3>

The prototypes of two of my visualizations are below.

<br>

</div>


<h1 id="mapTitle"> 311 Cases - Muni Feedback </h1>
<div id="mapChart"></div>

<br>
<br>

<h1 id="barchartsTitle"> Muni 311 Reports by Neighborhood </h1>
<div id="barcharts"></div>

<script src="http://d3js.org/d3.v3.min.js"></script>
<script src="http://d3js.org/topojson.v1.min.js"></script>
<script src="http://labratrevenge.com/d3-tip/javascripts/d3.tip.v0.6.3.js"></script>


<div class="container">

<hr/>

<footer>
    <p style="text-align: center;">Griffin Okamoto &bullet; MSAN 622 Information Visualization &bullet; Spring 2015</p>
</footer>

</div><!--/.container -->

<script src="../js/jquery.min.js"></script>
<script src="../js/bootstrap.min.js"></script>
<!-- <script src="../js/d3.min.js"></script> -->

<script>

function barchart() {
    // Chart dimensions.
    var margin = {top: 30, right: 20, bottom: 40, left: 50},
        width = 900 - margin.right - margin.left,
        height = 120 - margin.top - margin.bottom;

    var color = d3.scale.category10();

    var x = d3.scale.ordinal()
        .rangeRoundBands([0, width], .1);

    var y = d3.scale.linear()
        .range([height, 0])
        .nice();

    var xAxis = d3.svg.axis()
        .scale(x)
        .orient("bottom");

    var yAxis = d3.svg.axis()
        .scale(y)
        .orient("left")
        .ticks(4);

    // Load the data.
    d3.json("sf311_just2015_muni.json", function(json_data) {

        var data1 = {};
        var categories = [];

        json_data.forEach(function(d) {
            cat = d["Request.Type2"]
            categories.push(cat);
            if(d.Neighborhood in data1) {
                if(cat in data1[d.Neighborhood]) {
                    data1[d.Neighborhood][cat] += 1; 
                }
                else {
                    data1[d.Neighborhood][cat] = 1; 
                }
            }
            else {
                data1[d.Neighborhood] = {};
                data1[d.Neighborhood][cat] = 1;
            }
        });

        categories = categories.filter(function(v, i) { 
            return categories.indexOf(v) === i; 
        });

        data = d3.entries(data1);

        // x.domain(Object.keys(data[0].value));
        x.domain(categories);
        y.domain([0, 60]);
        // y.domain([0, .65])''

        console.log(data);

        // Add an SVG element for each symbol, with the desired dimensions and margin.
        var svg = d3.select("div#barcharts").selectAll("svg")
            .data(data)
        .enter().append("svg")
            .attr("id", function(d) { return d.key; })
            .attr("width", width + margin.left + margin.right)
            .attr("height", height + margin.top + margin.bottom)
            .append("g")
                .attr("transform", "translate(" + margin.left + "," + margin.top + ")");

        svg.append("g")
            .data(data)
            .attr("class", "x axis")
            .attr("transform", "translate(0," + (height) + ")")
            .call(xAxis)
            .selectAll("text")  
                .style("text-anchor", "middle")
                .attr("dx", "0")
                .attr("dy", "1em");

        svg.append("g")
                .attr("class", "y axis")
                .call(yAxis)
            .append("text")
                // .attr("transform", "rotate(-90)")
                .attr("x", -10)
                .attr("y", margin.top-40)
                .style("text-anchor", "end")
                .text("Count")
                .style("font-weight", "bold");

        svg.append("text")
            .attr("class", "neighborhoodLabel")
            .attr("text-anchor", "end")
            .attr("x", width)
            .attr("y", margin.top-30)
            .text(function(d) { return d.key; });

        var bars = svg.append("g")
            .attr("class", "bars");

        var barGroup = bars.selectAll(".bar")
            .data(function(d) { 
                return d3.entries(d.value);
            })
            .enter().append("g")
            .attr("class", function(d) { return d.key; });

        barGroup.append("rect")
            .attr("class", function(d) { return d.key; })
            .attr("x", function(d) { 
                return x(d.key); 
            })
            .attr("width", x.rangeBand())
            .attr("y", function(d) { return y(d.value); })
            .attr("height", function(d) { return height - y(d.value); })
            .style("fill", function(d) {
                return color(d.key);
            });
    });
};

barchart();


//(function() {

    var width = 800,
        height = 700;

    var color = d3.scale.category10();

    var tip = d3.tip()
      .attr('class', 'd3-tip')
      .offset([-10, 0])
      .html(function(d) {
        return "<div>" + d.Address + "</div>"
        + "<div>" + d.Neighborhood + "</div>" 
        + "<div><strong> Request Type:</strong> " + d["Request.Type2"] + "</div>"
        + "<div><strong> Details:</strong> " + d["Request.Details"] + "</div>";
      });

    var svg = d3.select("#mapChart").append("svg")
        .attr("width", width)
        .attr("height", height)
        .style("background-color", '#D1F0FF');

    svg.call(tip);

    d3.json("sf_neighborhoods.json", function(error, ca) {

        var featureCollection = topojson.feature(ca, ca.objects.collection);
        var bounds = d3.geo.bounds(featureCollection);

        var centerX = d3.sum(bounds, function(d) {return d[0];}) / 2,
            centerY = d3.sum(bounds, function(d) {return d[1];}) / 2;

        var projection = d3.geo.mercator()
            .scale(250000)
            // .translate([width / 2, height / 2])
            .center([centerX+.02, centerY+.02-0.001]);

        var path = d3.geo.path()
            .projection(projection);

        svg.append("path")
            .datum(topojson.feature(ca, ca.objects.collection))
            .attr("class", "land")
            .attr("d", path);

        svg.append("path")
            .datum(topojson.mesh(ca, ca.objects.collection, function(a, b) { return a !== b; }))
            .attr("class", "boundary")
            .attr("d", path);

        d3.json("sf311_just2015_muni.json", function(dataError, data) {

            data.forEach(function(d) {
                var loc = d.Point.split(",");
                d.latitude = loc[0].slice(1);
                d.longitude = loc[1].slice(1,-1);
            })

            var dots = svg.append("g")
                .attr("class", "dots")

            var dotGroups = svg.selectAll(".dot")
                .data(data)
                .enter().append("g")
                    .attr("class", "dot");

            dotGroups.append("circle")
                .attr("r", 4)
                .attr("cx", function(d, i) {
                    // projection takes [longitude, latitude]
                    // and returns [x, y] as output
                    return projection([d.longitude, d.latitude])[0];
                })
                .attr("cy", function(d, i) {
                    return projection([d.longitude, d.latitude])[1];
                })
                .style("fill", function(d) {
                    return color(d["Request.Type2"]);
                })
                .style("opacity", 0.7)
                .on('mouseover', tip.show)
                .on('mouseout', tip.hide);
        });

    });

    d3.select(self.frameElement).style("height", height + "px");

//})();

</script>


</body>
</html>